	*=$6000

step	= $D0
stars	= $D1 ;16b
loops	= $D3

	JMP STARS_INIT
	JMP STARS_RENDER

STARS_INIT
	LDA #0
	STA step
	RTS

STARS_RENDER
	LDX step
	CPX #50
	BNE +
	LDA #-1
	STA step
	LDX #0
+	INC step
	; start rendering stars
	LDA STARS_LO,X
	STA stars
	LDA STARS_HI,X
	STA stars+1
.bigloop	LDY #0
	LDA (stars),Y	; number of writes
	BEQ .end
	STA loops
	INY
	LDA (stars),Y	; value to write
	TAX
.loopw	INY
	LDA (stars),Y
	STA .mod+1
	INY
	LDA (stars),Y
	STA .mod+2
.mod	STX $200		; write value in framebuffer
	DEC loops
	BNE .loopw	; next write for the same value
	CLC
	INY
	TYA
	ADC stars		; ptr to next big loop
	BCC +
	INC stars+1
+	STA stars
	JMP .bigloop
.end	RTS



STARS_LO
	!byte <FRAME0,<FRAME1,<FRAME2,<FRAME3,<FRAME4,<FRAME5,<FRAME6,<FRAME7,<FRAME8,<FRAME9,<FRAME10,<FRAME11
	!byte <FRAME12,<FRAME13,<FRAME14,<FRAME15,<FRAME16,<FRAME17,<FRAME18,<FRAME19,<FRAME20,<FRAME21,<FRAME22,<FRAME23,<FRAME24,<FRAME25
	!byte <FRAME26,<FRAME27,<FRAME28,<FRAME29,<FRAME30,<FRAME31,<FRAME32,<FRAME33,<FRAME34,<FRAME35,<FRAME36,<FRAME37,<FRAME38,<FRAME39
	!byte <FRAME40,<FRAME41,<FRAME42,<FRAME43,<FRAME44,<FRAME45,<FRAME46,<FRAME47,<FRAME48,<FRAME49
	; !byte <FRAME50,<FRAME51,<FRAME52,<FRAME53
	; !byte <FRAME54,<FRAME55,<FRAME56,<FRAME57,<FRAME58,<FRAME59,<FRAME60,<FRAME61,<FRAME62,<FRAME63,<FRAME64,<FRAME65,<FRAME66,<FRAME67
	; !byte <FRAME68,<FRAME69,<FRAME70,<FRAME71,<FRAME72,<FRAME73,<FRAME74,<FRAME75,<FRAME76,<FRAME77,<FRAME78,<FRAME79,<FRAME80,<FRAME81
	; !byte <FRAME82,<FRAME83,<FRAME84,<FRAME85,<FRAME86,<FRAME87,<FRAME88,<FRAME89,<FRAME90,<FRAME91,<FRAME92,<FRAME93,<FRAME94,<FRAME95
	; !byte <FRAME96,<FRAME97,<FRAME98,<FRAME99
	!byte 0
STARS_HI
	!byte >FRAME0,>FRAME1,>FRAME2,>FRAME3,>FRAME4,>FRAME5,>FRAME6,>FRAME7,>FRAME8,>FRAME9,>FRAME10,>FRAME11,>FRAME12,>FRAME13,>FRAME14,>FRAME15,>FRAME16,>FRAME17,>FRAME18,>FRAME19,>FRAME20,>FRAME21,>FRAME22,>FRAME23,>FRAME24,>FRAME25,>FRAME26,>FRAME27,>FRAME28,>FRAME29,>FRAME30,>FRAME31,>FRAME32,>FRAME33,>FRAME34,>FRAME35,>FRAME36,>FRAME37,>FRAME38,>FRAME39,>FRAME40,>FRAME41,>FRAME42,>FRAME43,>FRAME44,>FRAME45,>FRAME46,>FRAME47,>FRAME48,>FRAME49
	; !byte >FRAME50,>FRAME51,>FRAME52,>FRAME53,>FRAME54,>FRAME55,>FRAME56,>FRAME57,>FRAME58,>FRAME59,>FRAME60,>FRAME61,>FRAME62,>FRAME63,>FRAME64,>FRAME65
	; !byte >FRAME66,>FRAME67,>FRAME68,>FRAME69,>FRAME70,>FRAME71,>FRAME72,>FRAME73,>FRAME74,>FRAME75,>FRAME76,>FRAME77,>FRAME78,>FRAME79,>FRAME80,>FRAME81,>FRAME82,>FRAME83,>FRAME84,>FRAME85,>FRAME86,>FRAME87,>FRAME88,>FRAME89,>FRAME90,>FRAME91,>FRAME92,>FRAME93,>FRAME94,>FRAME95,>FRAME96,>FRAME97,>FRAME98,>FRAME99
	!byte 0

	!source "starfield_data.a"